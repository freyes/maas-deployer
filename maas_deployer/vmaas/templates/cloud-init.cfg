#cloud-config
user: {{ user }}
password: {{ password }}
chpasswd: { expire: False }
ssh_pwauth: True

{% if ssh_key %}
ssh_authorized_keys:
  - {{ ssh_key }}
{% endif %} 

{% if hostname -%}
hostname: {{ hostname }}
manage_etc_hosts: True
{%- endif %}

{% if apt_http_proxy -%}
apt_proxy: {{ apt_http_proxy }}
{%- endif %}

apt_sources:
  - source: "ppa:maas-maintainers/stable"
  - source: "ppa:juju/stable"

write_files:
-   content: |
{{network_config}}
    path: /etc/network/interfaces

packages:
  # MAAS Core Packages
  - maas
  - maas-dhcp
  - maas-dns
  # Used to manage KVM instances via libvirt
  - libvirt-bin
  - linux-image-extra-virtual
  - jq
  - juju-core
  - juju-deployer
  # Python libraries used for the maas configuration script
  - python-bson
  - python-httplib2
  - python-jinja2
  - python-maas-client
  - python-yaml
  # Misc
  - ntp

final_message: "MAAS controller is now configured."
